<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>A 2D transform fault overlaying a 3D mantle · Oetqf</title><meta name="title" content="A 2D transform fault overlaying a 3D mantle · Oetqf"/><meta property="og:title" content="A 2D transform fault overlaying a 3D mantle · Oetqf"/><meta property="twitter:title" content="A 2D transform fault overlaying a 3D mantle · Oetqf"/><meta name="description" content="Documentation for Oetqf."/><meta property="og:description" content="Documentation for Oetqf."/><meta property="twitter:description" content="Documentation for Oetqf."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Oetqf</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>A 2D transform fault overlaying a 3D mantle</a></li></ul></li><li><a class="tocitem" href="../../APIs/">APIs</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>A 2D transform fault overlaying a 3D mantle</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>A 2D transform fault overlaying a 3D mantle</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/shipengcheng1230/Oetqf.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/shipengcheng1230/Oetqf.jl/blob/master/examples/otf-with-mantle.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><div class="admonition is-info" id="Note-31eade703b4ac9d3"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-31eade703b4ac9d3" title="Permalink"></a></header><div class="admonition-body"><p>This example corresponds to the simulations in Shi, P., Wei, M., &amp; Barbot, S., (2022), submitted to JGR - Solid Earth. The mesh size is downgraded for speed of the document building</p></div></div><pre><code class="language-julia hljs">using Oetqf, SpecialFunctions, Optim</code></pre><p>Generate the mesh for the transform fault, which is suited for using Okaka, (1992) equation:</p><pre><code class="language-julia hljs">mf = gen_mesh(Val(:RectOkada), 80e3, 8e3, 10e3, 2e3, 90.0);</code></pre><p>Use Gmsh to generate the mantle mesh, which is suited for using Barbot et al., (2017) equation, with no refinement in <strong>x</strong> or <strong>y</strong> direction while cell sizes are 1.5 times progressively larger along <strong>z</strong> axes:</p><pre><code class="language-julia hljs">gen_gmsh_mesh(Val(:BEMHex8Mesh), -40e3, -2.5e3, -8e3, 80e3, 5e3, -22e3, 4, 3, 3;
    output = joinpath(@__DIR__, &quot;mantle.vtk&quot;),
    rfzh = cumprod(ones(3) * 1.5), rfy = 1.0, rfyType = &quot;Bump&quot;
)
ma = gen_mesh(Val(:BEMHex8Mesh), joinpath(@__DIR__, &quot;mantle.vtk&quot;));</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Info    : Meshing 1D...
Info    : [  0%] Meshing curve 1 (Line)
Info    : [ 10%] Meshing curve 2 (Line)
Info    : [ 20%] Meshing curve 3 (Line)
Info    : [ 30%] Meshing curve 4 (Line)
Info    : [ 40%] Meshing curve 6 (Extruded)
Info    : [ 50%] Meshing curve 7 (Extruded)
Info    : [ 50%] Meshing curve 8 (Extruded)
Info    : [ 60%] Meshing curve 9 (Extruded)
Info    : [ 70%] Meshing curve 11 (Extruded)
Info    : [ 80%] Meshing curve 12 (Extruded)
Info    : [ 90%] Meshing curve 16 (Extruded)
Info    : [100%] Meshing curve 20 (Extruded)
Info    : Done meshing 1D (Wall 0.000216043s, CPU 0.000217s)
Info    : Meshing 2D...
Info    : [  0%] Meshing surface 1 (Transfinite)
Info    : [ 20%] Meshing surface 13 (Extruded)
Info    : [ 40%] Meshing surface 17 (Extruded)
Info    : [ 50%] Meshing surface 21 (Extruded)
Info    : [ 70%] Meshing surface 25 (Extruded)
Info    : [ 90%] Meshing surface 26 (Extruded)
Info    : Done meshing 2D (Wall 0.000257179s, CPU 0.000257s)
Info    : Meshing 3D...
Info    : Meshing volume 1 (Extruded)
Info    : Done meshing 3D (Wall 0.000123089s, CPU 0.000123s)
Info    : Optimizing mesh...
Info    : Done optimizing mesh (Wall 2.695e-06s, CPU 3e-06s)
Info    : 80 nodes 150 elements
Info    : Writing &#39;/home/runner/work/Oetqf.jl/Oetqf.jl/docs/build/generated/mantle.vtk&#39;...
Info    : Done writing &#39;/home/runner/work/Oetqf.jl/Oetqf.jl/docs/build/generated/mantle.vtk&#39;
Info    : Reading &#39;/home/runner/work/Oetqf.jl/Oetqf.jl/docs/build/generated/mantle.vtk&#39;...
Info    : Reading 80 points
Info    : Reading 150 cells
Info    : Done reading &#39;/home/runner/work/Oetqf.jl/Oetqf.jl/docs/build/generated/mantle.vtk&#39;</code></pre><p>Compute the stress Green&#39;s function between the two meshes:</p><pre><code class="language-julia hljs">λ = μ = 3e10
gffile = joinpath(@__DIR__, &quot;gf.h5&quot;)
isfile(gffile) &amp;&amp; rm(gffile)
@time gf₁₁ = stress_greens_function(mf, λ, μ; buffer_ratio = 1)
h5write(gffile, &quot;gf₁₁&quot;, gf₁₁) # fault -&gt; fault
@time gf₁₂ = stress_greens_function(mf, ma, λ, μ; buffer_ratio = 1, qtype = &quot;Gauss1&quot;)
h5write(gffile, &quot;gf₁₂&quot;, gf₁₂) # fault -&gt; mantle
@time gf₂₁ = stress_greens_function(ma, mf, λ, μ)
h5write(gffile, &quot;gf₂₁&quot;, gf₂₁) # mantle -&gt; fault
@time gf₂₂ = stress_greens_function(ma, λ, μ; qtype = &quot;Gauss1&quot;)
h5write(gffile, &quot;gf₂₂&quot;, gf₂₂) # mantle -&gt; mantle</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">  1.058959 seconds (2.36 M allocations: 112.262 MiB, 1.52% gc time, 99.89% compilation time)
  0.305441 seconds (239.73 k allocations: 11.629 MiB, 81.75% compilation time)
  4.593911 seconds (10.74 M allocations: 456.506 MiB, 1.30% gc time, 90.75% compilation time)
Maximum real part of eigval is: 1111120100.9504
  3.933751 seconds (1.20 M allocations: 63.159 MiB, 0.26% gc time, 26.20% compilation time)</code></pre><div class="admonition is-success" id="Tip-d4de8606188e0991"><header class="admonition-header">Tip<a class="admonition-anchor" href="#Tip-d4de8606188e0991" title="Permalink"></a></header><div class="admonition-body"><p>The <code>buffer_ratio</code> denotes the fraction to the original fault length on the two sides of the fault in which no dislocation occurs. It serves as a buffer zone to immitate the ridge section on the edges of an oceanic transform fault (personal communication with Yajing Liu). Basically, it affects how the stiffness tensor are periodically summed.</p></div></div><div class="admonition is-success" id="Tip-91800e4104342ee7"><header class="admonition-header">Tip<a class="admonition-anchor" href="#Tip-91800e4104342ee7" title="Permalink"></a></header><div class="admonition-body"><p>Notice that, in Gmsh before v4.9, the quadrature type &quot;Gauss2&quot; does not stand for the product rule, instead it is an optimized cubature rule (see <a href="https://gitlab.onelab.info/gmsh/gmsh/-/issues/1351">this issue</a>). For more cubature rules, see <a href="https://github.com/nschloe/quadpy">quadpy</a>.</p></div></div><p>Set up the rate-and-state friction parameters in the fault:</p><pre><code class="language-julia hljs">cs = 3044.14 # m/s
vpl = 140e-3 / 365 / 86400 # 140 mm/yr
v0 = 1e-6
f0 = 0.6
μ = 3e10
η = μ / 2cs # radiation damping
ν = λ / 2(λ + μ)
avw = 0.015
abvw = 0.0047
Dc = 8e-3
σmax = 5e7
a = ones(mf.nx, mf.nξ) .* avw
b = ones(mf.nx, mf.nξ) .* (avw - abvw)
L = ones(mf.nx, mf.nξ) .* Dc
σ = [min(σmax, 1.5e6 + 18.0e3 * z) for z in -mf.z] # Pa
σ = repeat(σ, 1, mf.nx)&#39; |&gt; Matrix # Pa
left_patch = @. -25.e3 ≤ mf.x ≤ -5.e3
right_patch = @. 5.e3 ≤ mf.x ≤ 25.e3
vert_patch = @. -6.e3 ≤ mf.z ≤ -1e3
b[xor.(left_patch, right_patch), vert_patch] .= avw + abvw # assign velocity weakening
pf = RateStateQuasiDynamicProperty(a, b, L, σ, η, vpl, f0, v0)
save_property(joinpath(@__DIR__, &quot;para-fault.bson&quot;), pf);</code></pre><p>Set up rheology parameters in the mantle assuming power-law viscosity with lab-derived results:</p><pre><code class="language-julia hljs">A_wet_dis = 3e1
Q_wet_dis = 480e3
V_wet_dis = 11e-6
m_wet_dis = 0
r_wet_dis = 1.2
n_wet_dis = 3.5
grain_size = 10000.0 # μm
COH = 1000 # ppm / HSi
𝙍 = 8.314 # gas contant
crust_depth = 7e3
κ = 8e-7
𝚃(z) = 1673 * erf(z / sqrt(4κ * 1e6 * 365 * 86400)) # 1 Myr OTF
𝙿(z) = 2800 * 9.8 * crust_depth + 3300 * 9.8 * (z - crust_depth)
prefactor_dis(z) = A_wet_dis / (1e6)^n_wet_dis * COH^r_wet_dis * grain_size^m_wet_dis * exp(-(Q_wet_dis + 𝙿(z) * V_wet_dis) / 𝙍 / 𝚃(z))
rel_dϵ = [0.0, -1e-12, 0.0, 0.0, 0.0, 0.0]
amplifier = 1e0
γ_dis = prefactor_dis.(-ma.cz) .* amplifier
pa = PowerLawViscosityProperty(γ_dis, ones(length(ma.cz)) * (n_wet_dis - 1), rel_dϵ) # notice to save `n-1` instead of `n` where `n` refers the stress power
save_property(joinpath(@__DIR__, &quot;para-mantle&quot; * &quot;.bson&quot;), pa);</code></pre><div class="admonition is-warning" id="Warning-5ebaeab3ed278ee0"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-5ebaeab3ed278ee0" title="Permalink"></a></header><div class="admonition-body"><p>Make sure your units are consistent across the whole variable space. Also, notice that we save <code>n-1</code> instead of <code>n</code> where <code>n</code> refers the stress power.</p></div></div><div class="admonition is-success" id="Tip-ceefa655bdc1e43f"><header class="admonition-header">Tip<a class="admonition-anchor" href="#Tip-ceefa655bdc1e43f" title="Permalink"></a></header><div class="admonition-body"><p>To load existing properties, use <code>load_property(YOUR_FILE, :RateStateQuasiDynamicProperty)</code> or <code>load_property(YOUR_FILE, :PowerLawViscosityProperty)</code> accordingly.</p></div></div><p>Set up initial conditions on the fault with an offset between left and right half fault:</p><pre><code class="language-julia hljs">vinit = pf.vpl .* ones(size(pf.a))
θinit = pf.L ./ vinit
θinit[1: size(θinit, 1) &gt;&gt; 1, :] ./= 1.1
θinit[size(θinit, 1) &gt;&gt; 1 + 1: end, :] ./= 2.5
δinit = zeros(size(pf.a));</code></pre><p>Set up initial conditions in the mantle</p><pre><code class="language-julia hljs">ϵinit = zeros(length(pa.γ), 6)
P = map(z -&gt; 2800 * 9.8 * crust_depth + 3300 * 9.8 * (z - crust_depth), -ma.cz) # change the depth of crust
σinit = repeat(P, 1, 6)
σinit[:,3] .= 0.0 # xz
σinit[:,5] .= 0.0 # yz
target(i) = x -&gt; (pa.γ[i] * (sqrt(2) * x) ^ (pa.n[i]) * x - abs(pa.dϵ₀[2])) ^ 2
σxyinit = -map(i -&gt; Optim.minimizer(optimize(target(i), 1e1, 1e14)), 1: length(pa.γ))
reldϵ = map(i -&gt; pa.γ[i] * (sqrt(2) * abs(σxyinit[i])) ^ (pa.n[i]) * σxyinit[i], 1: length(pa.γ))
@assert all(isapprox.(reldϵ, pa.dϵ₀[2]; rtol=1e-3))
σinit[:,2] .= σxyinit;</code></pre><p>Assemble the problem:</p><pre><code class="language-julia hljs">uinit = ArrayPartition(vinit, θinit, ϵinit, σinit, δinit)
prob = assemble(gf₁₁, gf₁₂, gf₂₁, gf₂₂, pf, pa, uinit, (0.0, 0.1 * 365 * 86400));</code></pre><p>Set up the saving scheme and solve the equation:</p><pre><code class="language-julia hljs">handler(u::ArrayPartition, t, integrator) = (u.x[1], u.x[2], integrator(integrator.t, Val{1}).x[3], u.x[3], u.x[4], u.x[5])
output = joinpath(@__DIR__, &quot;output.h5&quot;)
@time sol = wsolve(prob, VCABM5(), output, 100, handler, [&quot;v&quot;, &quot;θ&quot;, &quot;dϵ&quot;, &quot;ϵ&quot;, &quot;σ&quot;, &quot;δ&quot;], &quot;t&quot;;
    reltol=1e-6, abstol=1e-8, dtmax=0.2*365*86400, dt=1e-8, maxiters=1e9, stride=100, force=true
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: 1st order linear
t: 2-element Vector{Float64}:
 0.0
 3.1536e6
u: 2-element Vector{ArrayPartition{Float64, NTuple{5, Matrix{Float64}}}}:
 ([4.439370877727043e-9 4.439370877727043e-9 4.439370877727043e-9 4.439370877727043e-9; 4.439370877727043e-9 4.439370877727043e-9 4.439370877727043e-9 4.439370877727043e-9; … ; 4.439370877727043e-9 4.439370877727043e-9 4.439370877727043e-9 4.439370877727043e-9; 4.439370877727043e-9 4.439370877727043e-9 4.439370877727043e-9 4.439370877727043e-9], [1.6382337662337658e6 1.6382337662337658e6 1.6382337662337658e6 1.6382337662337658e6; 1.6382337662337658e6 1.6382337662337658e6 1.6382337662337658e6 1.6382337662337658e6; … ; 720822.857142857 720822.857142857 720822.857142857 720822.857142857; 720822.857142857 720822.857142857 720822.857142857 720822.857142857], [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], [2.993126315789474e8 -1.159793132258934e6 … 0.0 2.993126315789474e8; 4.865442105263158e8 -279723.0841659712 … 0.0 4.865442105263158e8; … ; 4.865442105263158e8 -279723.0841659712 … 0.0 4.865442105263158e8; 7.673915789473685e8 -235923.5595516861 … 0.0 7.673915789473685e8], [0.0 0.0 0.0 0.0; 0.0 0.0 0.0 0.0; … ; 0.0 0.0 0.0 0.0; 0.0 0.0 0.0 0.0])
 ([4.076715958989289e-9 4.072616164245145e-9 4.075442712126598e-9 4.088964986453331e-9; 3.4430994939670944e-9 3.417383507269353e-9 3.4394142408770543e-9 4.062644179678046e-9; … ; 7.586803484447171e-10 7.350000896538302e-10 7.495634381963362e-10 2.0502107855143374e-9; 2.0738117461621434e-9 2.038088880757506e-9 2.047039752307764e-9 2.096094491124679e-9], [1.8590418302568565e6 1.8598256460833005e6 1.8593496132564675e6 1.8570189571762218e6; 2.0017790265015583e6 2.0064139281027382e6 2.002447943468171e6 1.8612812874577832e6; … ; 2.8747044541461663e6 2.885326781900475e6 2.8786601284604673e6 2.2772683705092487e6; 2.270762754954703e6 2.279965869236065e6 2.2775966294517145e6 2.2647807208464365e6], [-1.9490353719142703e-10 -3.150225479742601e-6 … 1.117009381251456e-10 -5.7605857040498805e-12; -3.143400770248431e-10 -3.147648023609172e-6 … 4.658202337483857e-10 -4.579661948262328e-11; … ; -5.615414367667751e-10 -3.1305062949498476e-6 … -9.98692990183044e-10 -6.379063666159174e-10; -1.2895020205790048e-10 -3.1447258792037835e-6 … -6.507466105621481e-10 -2.713827511764087e-10], [2.993123106670286e8 -1.1588113187909983e6 … 109.26822681446149 2.993125101945185e8; 4.865440819229592e8 -279332.7091081294 … 107.15415541021898 4.865441499927149e8; … ; 4.8654392870839775e8 -278353.03260683204 … -211.77388305242889 4.8654394576009667e8; 7.673915013824518e8 -235463.28389308814 … -117.59525704444525 7.673914887318344e8], [0.013352977245283152 0.01334786179521655 0.01335086397226022 0.013365680395724845; 0.012402031284994014 0.012375690899781236 0.012398238171474936 0.013339120423498973; … ; 0.005481590194932253 0.00543582127551878 0.005464691937056686 0.008821136502916271; 0.008856835815734015 0.008807659239440364 0.008820414423926334 0.008889500625309089])</code></pre><div class="admonition is-success" id="Tip-a796d5f948f5bc85"><header class="admonition-header">Tip<a class="admonition-anchor" href="#Tip-a796d5f948f5bc85" title="Permalink"></a></header><div class="admonition-body"><p>See <a href="https://github.com/SciML/OrdinaryDiffEq.jl/issues/785">this issue</a> to know more about retrieving derivatives in the solution.</p></div></div><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../../APIs/">APIs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Thursday 5 June 2025 00:23">Thursday 5 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
